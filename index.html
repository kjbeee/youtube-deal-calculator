<!DOCTYPE html>
<html>
<head>
    <title>YouTube Sponsorship Price Calculator</title>
    <style>
        /* Your existing CSS styles */
        body { font-family: Arial, sans-serif; margin: 20px; }
        /* ... rest of your CSS ... */
        .channel-result {
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .channel-result button {
            margin-top: 5px;
        }
        /* ... any additional styles ... */
    </style>
</head>
<body>

<div class="header">
    <h1>YouTube Sponsorship Price Calculator</h1>
    <p>This calculator estimates the sponsorship fee for a YouTube creator based on their recent video performance.</p>
    <p>Search for a YouTube channel, and the calculator will automatically retrieve data from their latest videos.</p>
</div>

<form id="calculatorForm">
    <!-- Channel Search Section -->
    <label for="channelSearch">Search YouTube Channel:</label>
    <input type="text" id="channelSearch" name="channelSearch" placeholder="Enter channel name" required>
    <button type="button" onclick="searchChannel()">Search Channel</button>

    <div id="channelResults"></div>

    <!-- Creator Name -->
    <label for="creatorName">Creator Name:</label>
    <input type="text" id="creatorName" name="creatorName" required readonly>

    <!-- Rounding Switch -->
    <div class="switcher-container">
        <input type="checkbox" id="roundFees" name="roundFees">
        <label for="roundFees">Round fees down to the nearest $100</label>
    </div>

    <!-- Video Data -->
    <h2>Video Data</h2>
    <div class="video-grid" id="videosContainer"></div>

    <!-- Calculate Button -->
    <div class="button-container">
        <button type="button" onclick="calculateSponsorship()">Calculate Sponsorship Fee</button>
    </div>
</form>

<div id="resultsContainer">
    <!-- Results will be displayed here -->
</div>

<div class="history" id="historyContainer">
    <!-- Historical results will be displayed here -->
</div>

<script>
// Place your API key here
const API_KEY = 'AIzaSyDDpDLMGnQTwu4BJzNqPz1Wg630b9G6ZFI';

// Function to search for a channel by name
function searchChannel() {
    const query = document.getElementById('channelSearch').value;
    if (!query) {
        alert('Please enter a channel name.');
        return;
    }

    fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&maxResults=5&q=${encodeURIComponent(query)}&key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
            displayChannelResults(data.items);
        })
        .catch(error => {
            console.error('Error fetching channel data:', error);
            alert('An error occurred while searching for the channel.');
        });
}

// Function to display channel search results
function displayChannelResults(channels) {
    const channelResultsDiv = document.getElementById('channelResults');
    channelResultsDiv.innerHTML = '';

    if (channels.length === 0) {
        channelResultsDiv.innerHTML = '<p>No channels found.</p>';
        return;
    }

    channels.forEach(channel => {
        const channelDiv = document.createElement('div');
        channelDiv.className = 'channel-result';
        channelDiv.innerHTML = `
            <p>
                <strong>${channel.snippet.title}</strong><br>
                <img src="${channel.snippet.thumbnails.default.url}" alt="${channel.snippet.title}">
                <br>
                ${channel.snippet.description}<br>
                <button onclick="selectChannel('${channel.id.channelId}', '${channel.snippet.title.replace(/'/g, "\\'")}')">Select Channel</button>
            </p>
        `;
        channelResultsDiv.appendChild(channelDiv);
    });
}

// Function to handle channel selection
function selectChannel(channelId, channelTitle) {
    document.getElementById('creatorName').value = channelTitle;
    document.getElementById('channelResults').innerHTML = '';
    fetchChannelVideos(channelId);
}

// Function to fetch the channel's uploads playlist ID
function fetchChannelVideos(channelId) {
    fetch(`https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${channelId}&key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
            const uploadsPlaylistId = data.items[0].contentDetails.relatedPlaylists.uploads;
            fetchVideosFromPlaylist(uploadsPlaylistId);
        })
        .catch(error => {
            console.error('Error fetching channel uploads:', error);
            alert('An error occurred while fetching channel uploads.');
        });
}

// Function to fetch videos from the uploads playlist
function fetchVideosFromPlaylist(playlistId) {
    fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=10&playlistId=${playlistId}&key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
            const videoIds = data.items.map(item => item.snippet.resourceId.videoId);
            fetchVideoStatistics(videoIds);
        })
        .catch(error => {
            console.error('Error fetching playlist videos:', error);
            alert('An error occurred while fetching playlist videos.');
        });
}

// Function to fetch video statistics
function fetchVideoStatistics(videoIds) {
    fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoIds.join(',')}&key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
            populateVideoData(data.items);
        })
        .catch(error => {
            console.error('Error fetching video statistics:', error);
            alert('An error occurred while fetching video statistics.');
        });
}

// Function to populate video data into the form
function populateVideoData(videos) {
    // Clear existing video inputs
    const container = document.getElementById('videosContainer');
    container.innerHTML = '';

    videos.forEach((video, index) => {
        const i = index + 1;
        const videoDiv = document.createElement('div');
        videoDiv.className = 'video-input';
        videoDiv.innerHTML = `
            <h3>Video ${i}</h3>
            <label for="date${i}">Date Posted:</label>
            <input type="date" id="date${i}" name="date${i}" value="${formatDate(video.snippet.publishedAt)}" required>
            <label for="views${i}">Views:</label>
            <input type="number" id="views${i}" name="views${i}" value="${video.statistics.viewCount}" required>
            <label for="likes${i}">Likes:</label>
            <input type="number" id="likes${i}" name="likes${i}" value="${video.statistics.likeCount}" required>
            <label for="comments${i}">Comments:</label>
            <input type="number" id="comments${i}" name="comments${i}" value="${video.statistics.commentCount}" required>
        `;
        container.appendChild(videoDiv);
    });
}

// Helper function to format date to YYYY-MM-DD
function formatDate(dateString) {
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = (`0${(date.getMonth()+1)}`).slice(-2);
    const day = (`0${date.getDate()}`).slice(-2);
    return `${year}-${month}-${day}`;
}

// Existing code for your calculator
// ... include your existing JavaScript code here, such as calculateSponsorship(), displayResults(), updateHistory(), etc.

// Ensure that functions like calculateSponsorship() are updated to handle dynamic number of videos as shown in previous responses.

// Example: Adjust the calculateSponsorship() function to loop through the dynamic video inputs

function calculateSponsorship() {
    const creatorName = document.getElementById('creatorName').value;
    let totalViews = 0;
    let totalLikes = 0;
    let totalComments = 0;
    let videoCount = 0;

    const today = new Date();
    const last30Days = new Date();
    last30Days.setDate(today.getDate() - 30);

    const videoInputs = document.getElementsByClassName('video-input');

    // Gather data from each video
    for (let i = 0; i < videoInputs.length; i++) {
        const index = i + 1;
        const datePostedStr = document.getElementById(`date${index}`).value;
        const views = parseInt(document.getElementById(`views${index}`).value) || 0;
        const likes = parseInt(document.getElementById(`likes${index}`).value) || 0;
        const comments = parseInt(document.getElementById(`comments${index}`).value) || 0;

        // Convert date string to Date object
        const datePosted = new Date(datePostedStr);

        // Check if the video was posted within the last 30 days
        if (datePosted >= last30Days && datePosted <= today) {
            totalViews += views;
            totalLikes += likes;
            totalComments += comments;
            videoCount++;
        }
    }

    // Ensure there is at least one video in the last 30 days
    if (videoCount === 0) {
        alert("No videos were posted in the last 30 days. Cannot calculate estimated views.");
        return;
    }

    const estimatedViews = totalViews / videoCount;
    const engagementRate = totalViews > 0 ? ((totalLikes + totalComments) / totalViews) * 100 : 0;

    // Fixed CPM rates
    const minCPM = 5;
    const maxCPM = 10;

    // Determine if rounding is enabled
    const roundFees = document.getElementById('roundFees').checked;

    // Calculate fees
    let minFee = (estimatedViews / 1000) * minCPM;
    let maxFee = (estimatedViews / 1000) * maxCPM;

    // Apply rounding if checkbox is selected
    if (roundFees) {
        minFee = Math.floor(minFee / 100) * 100;
        maxFee = Math.floor(maxFee / 100) * 100;
    }

    // Create a result object
    const result = {
        timestamp: new Date(),
        creatorName,
        videoCount,
        estimatedViews: estimatedViews,
        engagementRate: engagementRate,
        minFee: minFee,
        maxFee: maxFee,
        minCPM,
        maxCPM,
        roundFees
    };

    // Add the result to the history array
    resultsHistory.push(result);

    // Update the results display
    displayResults(result);

    // Update the history display
    updateHistory();
}

// ... include the rest of your existing functions (displayResults, updateHistory, etc.)

</script>

</body>
</html>
