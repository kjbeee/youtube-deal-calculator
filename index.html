<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YouTube Sponsorship Price Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <!-- CSS Styles -->
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            background-color: #f4f4f4;
        }
        .header {
            background-color: #d32f2f;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .header h1 {
            margin-bottom: 10px;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }
        input[type="text"],
        input[type="number"],
        input[type="date"] {
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .video-input {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        .video-input h3 {
            margin-top: 0;
            color: #d32f2f;
        }
        .button-container {
            text-align: center;
            margin-top: 30px;
        }
        button {
            background-color: #d32f2f;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: #b71c1c;
        }
        .results,
        .history {
            margin-top: 40px;
        }
        .collapsible {
            background-color: #d32f2f;
            color: white;
            cursor: pointer;
            padding: 15px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 18px;
            margin-bottom: 5px;
            border-radius: 5px;
        }
        .active,
        .collapsible:hover {
            background-color: #b71c1c;
        }
        .content {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .content p {
            margin: 15px 0;
            color: #555;
        }
        .timestamp {
            font-size: 0.9em;
            color: #999;
        }
        .switcher-container {
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .channel-result {
            background-color: white;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .channel-result img {
            border-radius: 50%;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .channel-result button {
            background-color: #1976d2;
            margin-top: 10px;
        }
        .channel-result button:hover {
            background-color: #1565c0;
        }
        @media (max-width: 600px) {
            .button-container {
                margin-top: 20px;
            }
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>YouTube Sponsorship Price Calculator</h1>
    <p>Estimate sponsorship fees based on recent video performance.</p>
</div>

<div class="container">
    <form id="calculatorForm">
        <!-- Channel Search Section -->
        <label for="channelSearch">Search YouTube Channel:</label>
        <input type="text" id="channelSearch" name="channelSearch" placeholder="Enter channel name" required>
        <div class="button-container">
            <button type="button" onclick="searchChannel()">Search Channel</button>
        </div>
        <div id="channelResults"></div>

        <!-- Creator Name -->
        <label for="creatorName">Creator Name:</label>
        <input type="text" id="creatorName" name="creatorName" required readonly>

        <!-- Rounding Switch -->
        <div class="switcher-container">
            <input type="checkbox" id="roundFees" name="roundFees">
            <label for="roundFees">Round fees down to the nearest $100</label>
        </div>

        <!-- Video Data -->
        <h2>Video Data</h2>
        <div class="video-grid" id="videosContainer"></div>

        <!-- Calculate Button -->
        <div class="button-container">
            <button type="button" onclick="calculateSponsorship()">Calculate Sponsorship Fee</button>
        </div>
    </form>

    <div id="resultsContainer">
        <!-- Results will be displayed here -->
    </div>

    <div class="history" id="historyContainer">
        <!-- Historical results will be displayed here -->
    </div>
</div>

<script>
// Place your API key here
const API_KEY = 'AIzaSyDDpDLMGnQTwu4BJzNqPz1Wg630b9G6ZFI';

let resultsHistory = [];

// Function to search for a channel by name
function searchChannel() {
    const query = document.getElementById('channelSearch').value;
    if (!query) {
        alert('Please enter a channel name.');
        return;
    }

    fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&maxResults=5&q=${encodeURIComponent(query)}&key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
            displayChannelResults(data.items);
        })
        .catch(error => {
            console.error('Error fetching channel data:', error);
            alert('An error occurred while searching for the channel.');
        });
}

// Function to display channel search results
function displayChannelResults(channels) {
    const channelResultsDiv = document.getElementById('channelResults');
    channelResultsDiv.innerHTML = '';

    if (channels.length === 0) {
        channelResultsDiv.innerHTML = '<p>No channels found.</p>';
        return;
    }

    channels.forEach(channel => {
        const channelDiv = document.createElement('div');
        channelDiv.className = 'channel-result';
        channelDiv.innerHTML = `
            <strong>${channel.snippet.title}</strong><br>
            <img src="${channel.snippet.thumbnails.default.url}" alt="${channel.snippet.title}">
            <p>${channel.snippet.description}</p>
            <button onclick="selectChannel('${channel.id.channelId}', '${channel.snippet.title.replace(/'/g, "\\'")}')">Select Channel</button>
        `;
        channelResultsDiv.appendChild(channelDiv);
    });
}

// Function to handle channel selection
function selectChannel(channelId, channelTitle) {
    document.getElementById('creatorName').value = channelTitle;
    document.getElementById('channelResults').innerHTML = '';
    fetchChannelVideos(channelId);
}

// Function to fetch the channel's uploads playlist ID
function fetchChannelVideos(channelId) {
    fetch(`https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${channelId}&key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
            const uploadsPlaylistId = data.items[0].contentDetails.relatedPlaylists.uploads;
            fetchVideosFromPlaylist(uploadsPlaylistId);
        })
        .catch(error => {
            console.error('Error fetching channel uploads:', error);
            alert('An error occurred while fetching channel uploads.');
        });
}

// Function to fetch videos from the uploads playlist
function fetchVideosFromPlaylist(playlistId) {
    fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=10&playlistId=${playlistId}&key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
            const videoIds = data.items.map(item => item.snippet.resourceId.videoId);
            fetchVideoStatistics(videoIds);
        })
        .catch(error => {
            console.error('Error fetching playlist videos:', error);
            alert('An error occurred while fetching playlist videos.');
        });
}

// Function to fetch video statistics
function fetchVideoStatistics(videoIds) {
    fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoIds.join(',')}&key=${API_KEY}`)
        .then(response => response.json())
        .then(data => {
            populateVideoData(data.items);
        })
        .catch(error => {
            console.error('Error fetching video statistics:', error);
            alert('An error occurred while fetching video statistics.');
        });
}

// Function to populate video data into the form
function populateVideoData(videos) {
    // Clear existing video inputs
    const container = document.getElementById('videosContainer');
    container.innerHTML = '';

    videos.forEach((video, index) => {
        const i = index + 1;
        const videoDiv = document.createElement('div');
        videoDiv.className = 'video-input';
        videoDiv.innerHTML = `
            <h3>Video ${i}</h3>
            <label for="date${i}">Date Posted:</label>
            <input type="date" id="date${i}" name="date${i}" value="${formatDate(video.snippet.publishedAt)}" required>
            <label for="views${i}">Views:</label>
            <input type="number" id="views${i}" name="views${i}" value="${video.statistics.viewCount}" required>
            <label for="likes${i}">Likes:</label>
            <input type="number" id="likes${i}" name="likes${i}" value="${video.statistics.likeCount}" required>
            <label for="comments${i}">Comments:</label>
            <input type="number" id="comments${i}" name="comments${i}" value="${video.statistics.commentCount}" required>
        `;
        container.appendChild(videoDiv);
    });
}

// Helper function to format date to YYYY-MM-DD
function formatDate(dateString) {
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = (`0${(date.getMonth()+1)}`).slice(-2);
    const day = (`0${date.getDate()}`).slice(-2);
    return `${year}-${month}-${day}`;
}

// Function to calculate sponsorship fee
function calculateSponsorship() {
    const creatorName = document.getElementById('creatorName').value;
    let totalViews = 0;
    let totalLikes = 0;
    let totalComments = 0;
    let videoCount = 0;

    const today = new Date();
    const last30Days = new Date();
    last30Days.setDate(today.getDate() - 30);

    const videoInputs = document.getElementsByClassName('video-input');

    // Gather data from each video
    for (let i = 0; i < videoInputs.length; i++) {
        const index = i + 1;
        const datePostedStr = document.getElementById(`date${index}`).value;
        const views = parseInt(document.getElementById(`views${index}`).value) || 0;
        const likes = parseInt(document.getElementById(`likes${index}`).value) || 0;
        const comments = parseInt(document.getElementById(`comments${index}`).value) || 0;

        // Convert date string to Date object
        const datePosted = new Date(datePostedStr);

        // Check if the video was posted within the last 30 days
        if (datePosted >= last30Days && datePosted <= today) {
            totalViews += views;
            totalLikes += likes;
            totalComments += comments;
            videoCount++;
        }
    }

    // Ensure there is at least one video in the last 30 days
    if (videoCount === 0) {
        alert("No videos were posted in the last 30 days. Cannot calculate estimated views.");
        return;
    }

    const estimatedViews = totalViews / videoCount;
    const engagementRate = totalViews > 0 ? ((totalLikes + totalComments) / totalViews) * 100 : 0;

    // Fixed CPM rates
    const minCPM = 5;
    const maxCPM = 10;

    // Determine if rounding is enabled
    const roundFees = document.getElementById('roundFees').checked;

    // Calculate fees
    let minFee = (estimatedViews / 1000) * minCPM;
    let maxFee = (estimatedViews / 1000) * maxCPM;

    // Apply rounding if checkbox is selected
    if (roundFees) {
        minFee = Math.floor(minFee / 100) * 100;
        maxFee = Math.floor(maxFee / 100) * 100;
    }

    // Create a result object
    const result = {
        timestamp: new Date(),
        creatorName,
        videoCount,
        estimatedViews: estimatedViews,
        engagementRate: engagementRate,
        minFee: minFee,
        maxFee: maxFee,
        minCPM,
        maxCPM,
        roundFees
    };

    // Add the result to the history array
    resultsHistory.push(result);

    // Update the results display
    displayResults(result);

    // Update the history display
    updateHistory();
}

// Function to display the latest result
function displayResults(result) {
    const resultsContainer = document.getElementById('resultsContainer');
    resultsContainer.innerHTML = ''; // Clear previous content

    const collapsible = document.createElement('button');
    collapsible.className = 'collapsible';
    collapsible.textContent = `Latest Results for ${result.creatorName}`;
    collapsible.addEventListener('click', function() {
        this.classList.toggle('active');
        const content = this.nextElementSibling;
        if (content.style.maxHeight){
            content.style.maxHeight = null;
        } else {
            content.style.maxHeight = content.scrollHeight + "px";
        } 
    });

    const contentDiv = document.createElement('div');
    contentDiv.className = 'content';

    contentDiv.innerHTML = `
        <p><strong>Videos Considered:</strong> ${result.videoCount} (posted in the last 30 days)</p>
        <p><strong>Estimated Views:</strong> ${result.estimatedViews.toLocaleString(undefined, {maximumFractionDigits: 0})}</p>
        <p><strong>Engagement Rate:</strong> ${result.engagementRate.toFixed(2)}%</p>
        <p><strong>Minimum Fee:</strong> $${result.minFee.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} (CPM: $${result.minCPM})</p>
        <p><strong>Maximum Fee:</strong> $${result.maxFee.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} (CPM: $${result.maxCPM})</p>
        <p><strong>Fees Rounded:</strong> ${result.roundFees ? "Yes" : "No"}</p>
    `;

    resultsContainer.appendChild(collapsible);
    resultsContainer.appendChild(contentDiv);
}

// Function to update the results history display
function updateHistory() {
    const historyContainer = document.getElementById('historyContainer');
    historyContainer.innerHTML = ''; // Clear previous content

    if (resultsHistory.length === 0) return;

    const collapsible = document.createElement('button');
    collapsible.className = 'collapsible';
    collapsible.textContent = `Results History (${resultsHistory.length} entries)`;
    collapsible.addEventListener('click', function() {
        this.classList.toggle('active');
        const content = this.nextElementSibling;
        if (content.style.maxHeight){
            content.style.maxHeight = null;
        } else {
            content.style.maxHeight = content.scrollHeight + "px";
        } 
    });

    const contentDiv = document.createElement('div');
    contentDiv.className = 'content';

    resultsHistory.slice().reverse().forEach(result => {
        const timestamp = result.timestamp.toLocaleString();
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
            <p class="timestamp">${timestamp}</p>
            <p><strong>Creator Name:</strong> ${result.creatorName}</p>
            <p><strong>Videos Considered:</strong> ${result.videoCount}</p>
            <p><strong>Estimated Views:</strong> ${result.estimatedViews.toLocaleString(undefined, {maximumFractionDigits: 0})}</p>
            <p><strong>Engagement Rate:</strong> ${result.engagementRate.toFixed(2)}%</p>
            <p><strong>Minimum Fee:</strong> $${result.minFee.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} (CPM: $${result.minCPM})</p>
            <p><strong>Maximum Fee:</strong> $${result.maxFee.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} (CPM: $${result.maxCPM})</p>
            <p><strong>Fees Rounded:</strong> ${result.roundFees ? "Yes" : "No"}</p>
            <hr>
        `;
        contentDiv.appendChild(historyItem);
    });

    historyContainer.appendChild(collapsible);
    historyContainer.appendChild(contentDiv);
}
</script>

</body>
</html>
